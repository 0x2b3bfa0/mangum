



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Serverless ASGI adapters.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>How to deploy an ASGI app to AWS Lambda & API Gateway - Mangum</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#795548">
      
    
    
      <script src="../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="brown" data-md-color-accent="orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#how-to-deploy-an-asgi-app-to-aws-lambda-api-gateway" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Mangum" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Mangum
              </span>
              <span class="md-header-nav__topic">
                How to deploy an ASGI app to AWS Lambda & API Gateway
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/erm/mangum" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      erm/mangum
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Mangum" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    Mangum
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/erm/mangum" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      erm/mangum
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../azure-how-to/" title="How to deploy an ASGI app to Azure Functions" class="md-nav__link">
      How to deploy an ASGI app to Azure Functions
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        How to deploy an ASGI app to AWS Lambda & API Gateway
      </label>
    
    <a href="./" title="How to deploy an ASGI app to AWS Lambda & API Gateway" class="md-nav__link md-nav__link--active">
      How to deploy an ASGI app to AWS Lambda & API Gateway
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-setup-and-configuration" title="Step 1 - Setup and configuration" class="md-nav__link">
    Step 1 - Setup and configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-packaging-and-deployment" title="Step 2 - Packaging and deployment" class="md-nav__link">
    Step 2 - Packaging and deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-asgi-frameworks" title="Using ASGI frameworks" class="md-nav__link">
    Using ASGI frameworks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-considerations" title="Additional considerations" class="md-nav__link">
    Additional considerations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-setup-and-configuration" title="Step 1 - Setup and configuration" class="md-nav__link">
    Step 1 - Setup and configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-packaging-and-deployment" title="Step 2 - Packaging and deployment" class="md-nav__link">
    Step 2 - Packaging and deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-asgi-frameworks" title="Using ASGI frameworks" class="md-nav__link">
    Using ASGI frameworks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-considerations" title="Additional considerations" class="md-nav__link">
    Additional considerations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="how-to-deploy-an-asgi-app-to-aws-lambda-api-gateway">How to deploy an ASGI app to AWS Lambda &amp; API Gateway</h1>
<p>This guide will explain how to deploy a basic <a href="https://asgi.readthedocs.io/en/latest/">ASGI</a> application to AWS Lambda &amp; API Gateway. Mangum includes tools to assist with generating an example ASGI application using a <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html">AWS SAM (Serverless Application Model)</a> template.</p>
<p><strong>Note</strong>: These commands-much like most of the project currently-are being actively developed and may be buggy.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Python 3.6+</li>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html">AWS-CLI</a></li>
<li>AWS credentials</li>
</ul>
<h3 id="step-1-setup-and-configuration">Step 1 - Setup and configuration</h3>
<p>First, install Mangum with all the optional dependencies (needed for AWS):</p>
<div class="codehilite"><pre><span></span>$ pip3 install mangum<span class="o">[</span>full<span class="o">]</span>
</pre></div>


<p>Begin the process of generating a project:</p>
<div class="codehilite"><pre><span></span>$ mangum init
</pre></div>


<p>After answering a series of questions, the following will be generated in the current directory:</p>
<ul>
<li>
<p>A boilerplate ASGI app with the latest version of <code>mangum</code> installed from PyPi for deployment to AWS.</p>
</li>
<li>
<p>A <code>settings.json</code> file with the generated AWS resource information.</p>
</li>
<li>
<p>An S3 bucket to be used with the app.</p>
</li>
<li>
<p>A <code>template.yaml</code> containing the AWS SAM template.</p>
</li>
</ul>
<p>Once the initial configuration step is complete, you should have an app structure that looks like this:</p>
<div class="codehilite"><pre><span></span>├── README.md
├── my_project
│   ├── app.py
│   ├── mangum/
│   ├── requirements.txt
│   └── template.yaml
└── settings.json
</pre></div>


<h3 id="step-2-packaging-and-deployment">Step 2 - Packaging and deployment</h3>
<p>You will then be prompted to enter the following commands, these are simply wrappers around the AWS-CLI commands using the <code>settings.json</code> values generated previously as arguments.</p>
<div class="codehilite"><pre><span></span>$ magnum package
</pre></div>


<p>After packaging, you then can deploy:</p>
<div class="codehilite"><pre><span></span>$ mangum deploy
</pre></div>


<p><strong>Note</strong>: This may take awhile.</p>
<p>If the deployment is successful, then the API endpoints for the stages will be displayed:</p>
<div class="codehilite"><pre><span></span>Deployment successful! API endpoints available at:
* https://xxxxx.execute-api.ap-southeast-1.amazonaws.com/Prod
* https://xxxxx.execute-api.ap-southeast-1.amazonaws.com/Stage
</pre></div>


<p>Visiting the endpoint should then produce a simple "Hello World" response. If you run into any issues, you can lookup the function logs in CloudWatch or enter the following command:</p>
<div class="codehilite"><pre><span></span>$ mangum tail
</pre></div>


<p>This will tail the last 10 minutes of logs activity for the function.</p>
<h3 id="using-asgi-frameworks">Using ASGI frameworks</h3>
<p>The generated "hello world" application is a raw example, but you can easily use any ASGI framework with the adapter. For example, you could replace the content of the <code>app.py</code> generated previously with a Starlette application to achieve a similar result:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">mangum.adapters.aws</span> <span class="kn">import</span> <span class="n">run_asgi</span>

<span class="kn">from</span> <span class="nn">starlette.applications</span> <span class="kn">import</span> <span class="n">Starlette</span>
<span class="kn">from</span> <span class="nn">starlette.responses</span> <span class="kn">import</span> <span class="n">JSONResponse</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Starlette</span><span class="p">()</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="n">async</span> <span class="k">def</span> <span class="nf">homepage</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;hello&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">})</span>


<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">run_asgi</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>


<p>You would also have to include Starlette as a dependency in the package:</p>
<div class="codehilite"><pre><span></span>pip3 install . -t starlette
</pre></div>


<p>And re-run the <code>mangum package</code> and <code>mangum deploy</code> commands to update the function.</p>
<h3 id="additional-considerations">Additional considerations</h3>
<p>The application generation and deployment tools included in Mangum are mainly intended to quickly produce and deploy a very basic boilerplate application.</p>
<p><strong>Keep in mind:</strong></p>
<ul>
<li>
<p>As of this writing, only simple application examples have been tested with the adapters (work-in-progress).</p>
</li>
<li>
<p>AWS SAM templates are only means of handling the deployment and configuration, it was chosen here because it offered the path of least resistance to getting an app generated and deployed with all the necessary permissions/resources/roles/etc. included.</p>
</li>
<li>
<p>You will need to manually edit the generated AWS SAM template to extend the functionality of the stack and leverage additional AWS services.</p>
</li>
</ul>
<p>At some point it would be nice to improve the CLI tool to be more comprehensive with some validation/safety features and possibly a way to eliminate the AWS-CLI as a requirement for deployment/packaging. </p>
<p>There is an open issue for doing so <a href="https://github.com/erm/mangum/issues/10">here</a>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../azure-how-to/" title="How to deploy an ASGI app to Azure Functions" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                How to deploy an ASGI app to Azure Functions
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>